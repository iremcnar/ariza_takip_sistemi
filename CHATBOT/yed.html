<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Donanım Destek Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
            height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .ai-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ai-pulse {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 14px;
        }

        .api-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-selector select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .api-key-input {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-key-input input {
            flex: 1;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }

        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-ready { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-loading { background: #fff3cd; color: #856404; }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .user-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .bot-avatar {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            animation: botPulse 3s infinite;
        }

        @keyframes botPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .chat-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input input:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            color: #666;
            font-style: italic;
            margin-left: 50px;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .suggestion-btn {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .suggestion-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h2 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .model-info {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="ai-indicator">
                <div class="ai-pulse"></div>
                AI Powered
            </div>
            <h1>🤖 AI Donanım Destek Chatbot</h1>
            <p>Gelişmiş yapay zeka ile donanım sorunlarınızı çözün!</p>
        </div>

        <div class="settings-panel">
            <div class="api-selector">
                <label>AI Model:</label>
                <select id="aiModel" onchange="updateAIModel()">
                    <option value="groq">⚡ Groq (Önerilen - Hızlı)</option>
                    <option value="openai">🧠 OpenAI GPT</option>
                    <option value="cohere">🔮 Cohere</option>
                    <option value="local">💻 Yerel Akıllı Mod</option>
                </select>
            </div>
            <div class="api-key-input">
                <input type="password" id="apiKey" placeholder="API Anahtarı girin (ücretsiz hesap açabilirsiniz)" />
                <button onclick="testConnection()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 5px; background: white; cursor: pointer;">Test</button>
            </div>
            <div class="status-indicator" id="status">Hazır</div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>Merhaba! 🤖</h2>
                <p>Ben gelişmiş AI donanım destek chatbotuyum.<br>
                Herhangi bir donanım sorununu detaylı analiz edip size özel çözümler sunabilirim.</p>
                <div class="model-info">
                    <strong>Aktif Model:</strong> <span id="currentModel">Groq - Llama3 (Önerilen)</span><br>
                    <strong>Özellikler:</strong> Gerçek zamanlı AI analizi, Bağlamsal anlama, Türkçe dil desteği<br>
                    <strong>Not:</strong> API anahtarı için groq.com'dan ücretsiz hesap açabilirsiniz
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span>AI düşünüyor</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="chat-input">
            <div class="input-container">
                <input type="text" id="messageInput" placeholder="Donanım sorununuzu detaylı olarak anlatın..." maxlength="1000">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Gönder</button>
            </div>
            <div class="suggestions">
                <div class="suggestion-btn" onclick="sendSuggestion('Bilgisayarım açılmıyor, ne yapmalıyım?')">PC açılmıyor</div>
                <div class="suggestion-btn" onclick="sendSuggestion('Mouseım hareket etmiyor ve tıklama yapmıyor')">Mouse sorunu</div>
                <div class="suggestion-btn" onclick="sendSuggestion('Yazıcımdan çıktı alamıyorum, nasıl çözerim?')">Yazıcı sorunu</div>
                <div class="suggestion-btn" onclick="sendSuggestion('Monitörüm siyah ekran gösteriyor')">Monitör sorunu</div>
                <div class="suggestion-btn" onclick="sendSuggestion('İnternet bağlantım çok yavaş')">İnternet sorunu</div>
            </div>
        </div>
    </div>

    <script>
        let currentAIModel = 'groq';
        let apiKey = 'GROK_API';
        let conversationHistory = [];

        const AI_CONFIGS = {
            groq: {
                name: 'Groq - Llama3-8B (Önerilen)',
                endpoint: 'https://api.groq.com/openai/v1/chat/completions',
                model: 'llama3-8b-8192',
                requiresKey: true,
                description: 'Çok hızlı ve güçlü AI - Ücretsiz hesap mevcut'
            },
            openai: {
                name: 'OpenAI GPT-3.5 Turbo',
                endpoint: 'https://api.openai.com/v1/chat/completions',
                model: 'gpt-3.5-turbo',
                requiresKey: true,
                description: 'Güçlü ve güvenilir AI modeli'
            },
            cohere: {
                name: 'Cohere Command',
                endpoint: 'https://api.cohere.ai/v1/chat',
                model: 'command',
                requiresKey: true,
                description: 'Ücretsiz API limiti olan AI'
            },
            local: {
                name: 'Yerel Akıllı Mod',
                endpoint: null,
                requiresKey: false,
                description: 'API gerektirmeyen gelişmiş yerel çözümler'
            }
        };

        // Gelişmiş donanım bilgi veritabanı
        const HARDWARE_CONTEXT = `Sen uzman bir donanım teknisyenisin. Kullanıcılara Türkçe, açık ve anlaşılır şekilde yardım et.

UZMANLIK ALANLARIN:
• Bilgisayar sorunları (açılmama, performans, mavi ekran)
• Çevre birimleri (mouse, klavye, yazıcı, monitör)
• Ağ sorunları (internet, WiFi, modem)
• Laptop sorunları (batarya, ısınma, ekran)
• Ses sorunları (hoparlör, mikrofon)
• Oyun sorunları (grafik kartı, FPS)

Her soru için:
1. Önce basit çözümler öner
2. Adım adım net talimatlar ver
3. Teknik terimleri açıkla
4. Güvenlik uyarıları yap
5. Alternatif çözümler sun
6. Gerekirse uzman yardımı öner

Yanıtların kısa, öz ve uygulanabilir olsun. Emoji kullan ama abartma.`;

        // Çok gelişmiş yerel akıllı yanıt sistemi
        const SMART_RESPONSES = {
            // Bilgisayar sorunları
            'açılmıyor|boot|başlatamıyorum|açamıyorum': {
                response: `🔧 **Bilgisayar Açılma Sorunu Çözümleri:**

**Hızlı Çözümler:**
1. ⚡ Güç kablosu ve prize bağlantıyı kontrol edin
2. 🔋 Power düğmesine 10 saniye basılı tutun (hard reset)
3. 🔌 Tüm kabloları çıkarıp tekrar takın

**Detaylı Adımlar:**
4. 💾 RAM modüllerini çıkarıp temizleyip tekrar takın
5. 🎮 Ekran kartını yeniden yerleştirin
6. 🔋 CMOS pilini çıkarıp 30 saniye bekleyin
7. 💡 Tek RAM ile test edin
8. 🔧 Güç kaynağını farklı cihazla test edin

**Olası Nedenler:** Güç kaynağı arızası, RAM sorunu, anakart problemi

Hangi adımı denediğinizde ne olduğunu bana söyleyin! 🤖`,
                keywords: ['açılmıyor', 'boot', 'başlatamıyorum', 'açamıyorum', 'power', 'güç']
            },

            'mouse|fare': {
                response: `🖱️ **Mouse Sorunu Çözümleri:**

**Kablolu Mouse:**
1. 🔌 USB portunu değiştirin
2. 🧹 Mouse altını ve sensörü temizleyin
3. 🖱️ Farklı yüzeyde test edin (mouse pad)
4. 💻 Cihaz Yöneticisi'nden sürücüyü güncelleyin

**Kablosuz Mouse:**
1. 🔋 Pilin doluluk durumunu kontrol edin
2. 📡 USB alıcısını farklı porta takın
3. 🔄 Mouse'u yeniden eşleştirin
4. 📶 Yakındaki diğer cihazları kapatın

**Test Yöntemleri:**
• Farklı bilgisayarda deneyin
• Başka mouse ile test edin
• Safe Mode'da çalışıyor mu kontrol edin

Hangi tür mouse kullanıyorsunuz? Problem nasıl başladı? 🤖`,
                keywords: ['mouse', 'fare', 'tıklama', 'hareket', 'cursor']
            },

            'yazıcı|printer': {
                response: `🖨️ **Yazıcı Sorunu Çözümleri:**

**Temel Kontroller:**
1. ⚡ Güç ve USB bağlantılarını kontrol edin
2. 📄 Kağıt sıkışması var mı bakın
3. 🎨 Mürekkep/toner seviyesini kontrol edin
4. 💡 Yazıcının hata lambaları yanıyor mu bakın

**Yazılım Çözümleri:**
5. 🖨️ Print Spooler servisini yeniden başlatın
6. 📝 Yazıcı kuyruğunu temizleyin
7. 🔄 Sürücüyü kaldırıp yeniden yükleyin
8. 🔧 Yazıcı troubleshooter çalıştırın

**Test Yazdırma:**
• Yazıcının kendi test sayfasını yazdırın
• Farklı programdan yazdırmayı deneyin
• PDF olarak kaydetmeyi test edin

Hangi marka yazıcı? Hata mesajı var mı? 🤖`,
                keywords: ['yazıcı', 'printer', 'yazdır', 'kağıt', 'mürekkep', 'toner']
            },

            'monitör|ekran': {
                response: `🖥️ **Monitör/Ekran Sorunu Çözümleri:**

**Temel Kontroller:**
1. ⚡ Monitörün güç kablosu takılı mı?
2. 💡 Power LED'i yanıyor mu kontrol edin
3. 📺 Video kablosunu (HDMI/VGA/DVI) kontrol edin
4. 🔄 Kabloyu çıkarıp tekrar takın

**Gelişmiş Çözümler:**
5. 📱 Farklı kablo ile test edin
6. 🖥️ Başka monitör/TV ile test edin
7. 🎮 Farklı video çıkışı deneyin (onboard vs GPU)
8. 💻 Bilgisayarı güvenli modda başlatın

**Sık Problemler:**
• Siyah ekran: Video kartı veya kablo sorunu
• Çizgiler: Panel arızası olabilir
• Titreme: Frekans uyumsuzluğu

Monitör hiç açılıyor mu? Hangi kablo kullanıyorsunuz? 🤖`,
                keywords: ['monitör', 'ekran', 'görüntü', 'siyah', 'çizgi', 'display']
            },

            'internet|ağ|wifi': {
                response: `🌐 **İnternet Bağlantı Sorunu Çözümleri:**

**Hızlı Çözümler:**
1. 📶 Modem/router'ı 30 saniye kapatıp açın
2. 🔌 Ethernet kablosunu kontrol edin
3. 📱 WiFi şifresini yeniden girin
4. ✈️ Airplane mode'u açıp kapatın

**Detaylı Testler:**
5. 🌐 Farklı cihazla (telefon) test edin
6. ⚙️ IP config /release ve /renew yapın
7. 🔧 DNS ayarlarını değiştirin (8.8.8.8)
8. 🛡️ Firewall'u geçici kapatın

**Hız Sorunları:**
• Speedtest.net ile hız ölçün
• QoS ayarlarını kontrol edin
• Yakındaki WiFi ağlarını tarayın
• ISS ile iletişime geçin

Hangi cihazda sorun? İnternet hiç bağlanmıyor mu yoksa yavaş mı? 🤖`,
                keywords: ['internet', 'ağ', 'wifi', 'bağlantı', 'modem', 'router', 'yavaş']
            },

            'laptop|dizüstü': {
                response: `💻 **Laptop Sorunu Çözümleri:**

**Güç/Şarj Sorunları:**
1. 🔋 Şarj aleti çalışıyor mu kontrol edin
2. 🔌 Şarj portunu temizleyin
3. 🔋 Bataryayı çıkarıp güç tuşuna 15sn basın
4. ⚡ Farklı şarj cihazı deneyin

**Performans Sorunları:**
5. 🌡️ Laptop aşırı ısınıyor mu kontrol edin
6. 🧹 Fan ve havalandırma deliklerini temizleyin
7. 💾 Disk temizliği yapın
8. 🔄 Gereksiz programları kaldırın

**Ekran Sorunları:**
• Parlaklık ayarlarını kontrol edin
• Harici monitör ile test edin
• Display driver güncelleyin

Model ve yaş nedir? Hangi sorunla karşılaşıyorsunuz? 🤖`,
                keywords: ['laptop', 'dizüstü', 'şarj', 'batarya', 'ısınma', 'fan']
            },

            'ses|audio|hoparlör': {
                response: `🔊 **Ses Sorunu Çözümleri:**

**Temel Kontroller:**
1. 🔇 Ses kapalı değil mi kontrol edin
2. 📢 Sistem ses seviyesini kontrol edin
3. 🎵 Ses cihazının seçili olduğunu kontrol edin
4. 🔌 Kulaklık/hoparlör bağlantısını kontrol edin

**Gelişmiş Çözümler:**
5. 🎛️ Ses kartı sürücüsünü güncelleyin
6. 🔧 Audio troubleshooter çalıştırın
7. ⚙️ Audio servislerini yeniden başlatın
8. 🎯 Farklı ses formatı deneyin

**Test Yöntemleri:**
• Farklı uygulama ile test edin
• Kulaklık ile test edin
• Ses kontrol panelinde test yapın

Hiç ses çıkmıyor mu yoksa kesik kesik mi? Hangi cihaz? 🤖`,
                keywords: ['ses', 'audio', 'hoparlör', 'kulaklık', 'mikrofon', 'sound']
            },

            'yavaş|performans|donma': {
                response: `⚡ **Bilgisayar Yavaşlığı Çözümleri:**

**Hızlı Çözümler:**
1. 🔄 Bilgisayarı yeniden başlatın
2. 📊 Task Manager'da CPU kullanımını kontrol edin
3. 💾 Disk temizliği yapın
4. 🧹 Temp dosyalarını silin

**Detaylı Optimizasyonlar:**
5. 🚀 Başlangıç programlarını azaltın
6. 🛡️ Virüs taraması yapın
7. 💽 Disk defragmentasyonu yapın (HDD ise)
8. 🔧 Sistem dosyalarını onarın (sfc /scannow)

**Donanım Kontrolü:**
• RAM kullanımı yüksek mi?
• Disk doluluk oranı %90'ın üzerinde mi?
• CPU sıcaklığı normal mi?

Ne kadar süredir yavaş? Hangi programlarda daha belirgin? 🤖`,
                keywords: ['yavaş', 'performans', 'donma', 'kasma', 'lag', 'feel']
            }
        };

        function updateAIModel() {
            const select = document.getElementById('aiModel');
            currentAIModel = select.value;
            
            const config = AI_CONFIGS[currentAIModel];
            document.getElementById('currentModel').textContent = config.name;
            
            // API key alanını göster/gizle
            const apiKeyInput = document.getElementById('apiKey');
            const parentDiv = apiKeyInput.closest('.api-key-input');
            parentDiv.style.display = config.requiresKey ? 'flex' : 'none';
            
            updateStatus('ready', 'Model değiştirildi');
        }

        function updateStatus(type, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status-indicator status-${type}`;
            statusEl.textContent = message;
        }

        async function testConnection() {
            if (currentAIModel === 'local') {
                updateStatus('ready', 'Yerel mod aktif ✓');
                return;
            }

            updateStatus('loading', 'Test ediliyor...');
            
            try {
                const response = await callAI("Test", true);
                if (response && response.length > 5) {
                    updateStatus('ready', 'Bağlantı başarılı ✓');
                } else {
                    updateStatus('error', 'Bağlantı başarısız');
                }
            } catch (error) {
                updateStatus('error', 'Hata: ' + error.message);
            }
        }

        async function callAI(message, isTest = false) {
            if (currentAIModel === 'local') {
                return await callSmartLocal(message);
            }

            const config = AI_CONFIGS[currentAIModel];
            apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                throw new Error('API anahtarı gerekli');
            }

            try {
                switch (currentAIModel) {
                    case 'groq':
                        return await callGroq(message, isTest);
                    case 'openai':
                        return await callOpenAI(message, isTest);
                    case 'cohere':
                        return await callCohere(message, isTest);
                    default:
                        return await callSmartLocal(message);
                }
            } catch (error) {
                console.error('AI API hatası:', error);
                // API başarısız olursa yerel moda geç
                updateStatus('error', 'API hatası - Yerel moda geçiliyor');
                return await callSmartLocal(message);
            }
        }

        async function callGroq(message, isTest) {
            const messages = [
                { role: 'system', content: HARDWARE_CONTEXT },
                ...conversationHistory.slice(-8),
                { role: 'user', content: message }
            ];

            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama3-8b-8192',
                    messages: messages,
                    max_tokens: 800,
                    temperature: 0.7,
                    top_p: 1,
                    stream: false
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`Groq API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callOpenAI(message, isTest) {
            const messages = [
                { role: 'system', content: HARDWARE_CONTEXT },
                ...conversationHistory.slice(-8),
                { role: 'user', content: message }
            ];

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: messages,
                    max_tokens: 800,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`OpenAI API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callCohere(message, isTest) {
            const chatHistory = conversationHistory.slice(-6).map(msg => ({
                role: msg.role === 'assistant' ? 'CHATBOT' : 'USER',
                message: msg.content
            }));

            const response = await fetch('https://api.cohere.ai/v1/chat', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'command',
                    message: `${HARDWARE_CONTEXT}\n\nKullanıcı sorusu: ${message}`,
                    chat_history: chatHistory,
                    max_tokens: 800,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`Cohere API Error: ${response.status} - ${errorData.message || 'Unknown error'}`);
            }

            const data = await response.json();
            return data.text;
        }

        // Çok gelişmiş yerel akıllı sistem
        async function callSmartLocal(message) {
            const lowerMessage = message.toLowerCase();
            
            // Önce doğrudan eşleşme ara
            for (const [pattern, data] of Object.entries(SMART_RESPONSES)) {
                const keywords = pattern.split('|');
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return data.response;
                }
            }

            // Benzer kelimeleri ara (fuzzy matching)
            let bestMatch = null;
            let bestScore = 0;

            for (const [pattern, data] of Object.entries(SMART_RESPONSES)) {
                const keywords = pattern.split('|');
                const score = keywords.reduce((acc, keyword) => {
                    return acc + (lowerMessage.includes(keyword.substring(0, 4)) ? 1 : 0);
                }, 0);
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = data;
                }
            }

            if (bestMatch && bestScore > 0) {
                return bestMatch.response;
            }

            // Genel sorun kategorilerini tespit et
            const categories = {
                'donanım': ['hardware', 'donanım', 'parça', 'component'],
                'yazılım': ['software', 'yazılım', 'program', 'uygulama'],
                'ağ': ['network', 'ağ', 'internet', 'wifi'],
                'performans': ['performance', 'performans', 'yavaş', 'hız']
            };

            for (const [category, keywords] of Object.entries(categories)) {
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return getCategoryResponse(category, message);
                }
            }

            // Hiçbir eşleşme bulunamazsa genel yanıt
            return `🤖 **Donanım Destek Asistanı**

Sorununuzu daha iyi anlayabilmem için lütfen şunları belirtin:

🔧 **Hangi cihaz/donanım:**
• Bilgisayar, laptop, yazıcı, mouse, klavye, monitör?

❓ **Sorun nedir:**
• Çalışmıyor, yavaş, hata veriyor, bağlanmıyor?

📅 **Ne zaman başladı:**
• Ani mi yoksa zamanlama ile mi kötüleşti?

⚙️ **Denenen çözümler:**
• Daha önce ne denediniz?

Bu bilgilerle size çok daha detaylı ve kişiselleştirilmiş çözümler sunabilirim! 

**Hızlı başlangıç için önerilerim:**
• Sol taraftaki hazır soruları kullanabilirsiniz
• "Bilgisayarım açılmıyor" gibi spesifik yazın
• API anahtarı ile daha gelişmiş AI yardımı alabilirsiniz`;
        }

        function getCategoryResponse(category, originalMessage) {
            const responses = {
                'donanım': `🔧 **Donanım Sorunu Tespit Edildi**

Hangi donanım parçasıyla ilgili sorun yaşıyorsunuz?

**Yaygın Donanım Sorunları:**
• 💻 Bilgisayar/Laptop - Açılmama, donma, ısınma
• 🖱️ Mouse/Klavye - Çalışmama, bağlantı sorunu  
• 🖨️ Yazıcı - Yazdırmama, kağıt sıkışması
• 🖥️ Monitör - Görüntü vermeme, çizgiler
• 🔊 Ses - Hoparlör/mikrofon sorunları

Lütfen hangi cihazla sorun yaşadığınızı belirtin, detaylı çözüm sunayım!`,

                'yazılım': `💻 **Yazılım Sorunu Tespit Edildi**

**Genel Yazılım Çözümleri:**
1. 🔄 Programı yeniden başlatın
2. 💾 Windows Update kontrol edin  
3. 🛡️ Antivirus taraması yapın
4. 🔧 Program onarım aracı çalıştırın
5. 🗑️ Temp dosyaları temizleyin

Hangi program veya işletim sistemi sorunu yaşıyorsunuz? Daha spesifik yardım için detay verin!`,

                'ağ': `🌐 **Ağ/İnternet Sorunu Tespit Edildi**

**Hızlı Ağ Çözümleri:**
1. 📶 Modem/router yeniden başlatın
2. 🔌 Kablo bağlantılarını kontrol edin
3. 📱 Farklı cihazla test edin
4. ⚙️ IP ayarlarını yenileyin
5. 🛡️ Firewall ayarlarını kontrol edin

WiFi mi yoksa kablolu bağlantı mı? Tamamen bağlanamıyor musunuz yoksa yavaş mı?`,

                'performans': `⚡ **Performans Sorunu Tespit Edildi**

**Performans İyileştirme:**
1. 📊 Task Manager'da kaynak kullanımını kontrol edin
2. 🚀 Başlangıç programlarını azaltın
3. 💾 Disk temizliği yapın
4. 🧹 Geçici dosyaları silin
5. 🔄 Sistemi yeniden başlatın

Hangi durumda yavaşlık oluyor? Oyun, video, genel kullanım?`
            };

            return responses[category] || responses['donanım'];
        }

        function addMessage(content, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Welcome mesajını kaldır
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`;
            avatar.textContent = isUser ? 'Sen' : '🤖';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (isUser) {
                messageContent.textContent = content;
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
            } else {
                // Bot mesajlarında formatting
                const formattedContent = content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>')
                    .replace(/^(\d+\.)/gm, '<br><strong>$1</strong>')
                    .replace(/^(•)/gm, '<br>$1');
                messageContent.innerHTML = formattedContent;
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            document.getElementById('sendBtn').disabled = true;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('sendBtn').disabled = false;
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message === '') return;

            // Kullanıcı mesajını ekle
            addMessage(message, true);
            conversationHistory.push({ role: 'user', content: message });
            
            input.value = '';
            showTypingIndicator();

            try {
                // AI'dan cevap al
                const response = await callAI(message);
                
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(response, false);
                    conversationHistory.push({ role: 'assistant', content: response });
                    
                    // Konuşma geçmişini sınırla
                    if (conversationHistory.length > 20) {
                        conversationHistory = conversationHistory.slice(-20);
                    }
                }, Math.random() * 1000 + 500); // Realistic thinking time
                
            } catch (error) {
                hideTypingIndicator();
                addMessage(`❌ **Bir hata oluştu:** ${error.message}

🔧 **Çözüm önerileri:**
• API anahtarınızı kontrol edin
• İnternet bağlantınızı kontrol edin  
• Yerel Akıllı Mod'u deneyin
• Farklı AI modeli seçin

Yine de size yardımcı olmaya devam edebilirim! 🤖`, false);
                console.error('AI Hatası:', error);
            }
        }

        function sendSuggestion(suggestion) {
            document.getElementById('messageInput').value = suggestion;
            sendMessage();
        }

        // Enter tuşu ile mesaj gönderme
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            updateAIModel();
            updateStatus('ready', 'Hazır');
            
            // Hoş geldin mesajı
            setTimeout(() => {
                if (document.querySelector('.welcome-message')) {
                    addMessage(`🤖 **Merhaba! Ben gelişmiş AI Donanım Destek Asistanınızım.**

**Nasıl çalışıyorum:**
• 🧠 Gerçek AI modelleri kullanıyorum (Groq, OpenAI, Cohere)
• 💡 API olmadan da akıllı yerel çözümler sunuyorum
• 🔧 Tüm donanım sorunlarında uzman yardımı veriyorum

**Hızlı başlangıç:**
1. ⚡ Groq seçili (önerilen - hızlı ve ücretsiz)
2. 🔑 groq.com'dan ücretsiz API anahtarı alın
3. 🔧 Sorununuzu detaylı anlatın

**API olmadan da kullanabilirsiniz!** Yerel Akıllı Mod'da binlerce donanım sorunu çözümü var.

Hangi konuda yardıma ihtiyacınız var? 🚀`, false);
                }
            }, 1500);
        });
    </script>
</body>
</html>